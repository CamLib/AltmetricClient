from altmetric_client.altmetric_loader import AltmetricLoader
import json

class TestContextInformation:

    def setup_method(self):

        self.test_altmetric_loader = AltmetricLoader()

        test_json = '{"altmetric_id":1270180,"counts":{"readers":{"citeulike":"0","mendeley":"57","connotea":"0"},"total":{"posts_count":10},"twitter":{"unique_users_count":9,"unique_users":["youareinformed","medicineupdate","tomheston","jackcjay","MRCCTU","acvq2014","pranavi_r","37phoenix","allardmaryse5"],"posts_count":9},"wikipedia":{"unique_users_count":1,"unique_users":["en:841096"],"posts_count":1}},"selected_quotes":["Small AAA surveillance intervals","RRESCANstudy: Surveillance intervals of several years may be clinically acceptable for majority of pts with small AAA","Étude intéressante sur le suivi échographique des anévrismes de l''aorte. Small Abdominal Aortic Aneurysms"],"citation":{"abstract":"Small abdominal aortic aneurysms (AAAs [3.0 cm-5.4 cm in diameter]) are monitored by ultrasound surveillance. The intervals between surveillance scans should be chosen to detect an expanding aneurysm prior to rupture.","abstract_source":"pubmed","altmetric_jid":"4f6fa4ee3cf058f610002c38","authors":["Bown MJ","Sweeting MJ","Brown LC","Powell JT","Thompson SG"," "],"doi":"10.1001/jama.2013.950","first_seen_on":"2013-02-28T12:16:27+00:00","funders":["mrc","dohuk"],"issns":["1538-3598","0098-7484"],"issue":"8","journal":"JAMA: Journal of the American Medical Association","last_mentioned_on":1463179071,"links":["http://www.ncbi.nlm.nih.gov/pubmed/23443444?dopt=Abstract","http://jama.jamanetwork.com/article.aspx?articleid=1656254","http://www.ncbi.nlm.nih.gov/m/pubmed/23443444/","http://dx.doi.org/10.1001/jama.2013.950","http://jama.jamanetwork.com/article.aspx?articleid=1656254#.VOqTQerc_PE.twitter","http://jama.jamanetwork.com/article.aspx?articleid=1656254#.VzZXPIYG4u5.twitter","https://www.ncbi.nlm.nih.gov/pubmed/23443444"],"pmid":"23443444","pubdate":"2013-02-27T00:00:00+00:00","publisher_subjects":[{"name":"Medical And Health Sciences","scheme":"era"}],"scopus_subjects":["Medicine","Health Sciences"],"startpage":"806","subjects":["medicine"],"title":"Surveillance Intervals for Small Abdominal Aortic Aneurysms: A Meta-analysis","type":"article","uri":"http://jama.jamanetwork.com/article.aspx?doi=10.1001/jama.2013.950","volume":"309","mendeley_url":"http://www.mendeley.com/research/surveillance-intervals-small-abdominal"},"altmetric_score":{"score":8.75,"score_history":{"1y":0,"6m":0,"3m":0,"1m":0,"1w":0,"6d":0,"5d":0,"4d":0,"3d":0,"2d":0,"1d":0,"at":8.75},"context_for_score":{"all":{"total_number_of_other_articles":7836474,"mean":6.6411354526402,"rank":913566,"this_scored_higher_than_pct":88,"this_scored_higher_than":6920520,"rank_type":"exact","sample_size":7836474,"percentile":88},"similar_age_3m":{"total_number_of_other_articles":116158,"mean":6.4860486066273,"rank":14603,"this_scored_higher_than_pct":87,"this_scored_higher_than":101526,"rank_type":"exact","sample_size":116158,"percentile":87},"this_journal":{"total_number_of_other_articles":19364,"mean":35.048450550018,"rank":7541,"this_scored_higher_than_pct":61,"this_scored_higher_than":11815,"rank_type":"exact","sample_size":19364,"percentile":61},"similar_age_this_journal_3m":{"total_number_of_other_articles":121,"mean":33.572966666667,"rank":77,"this_scored_higher_than_pct":36,"this_scored_higher_than":44,"rank_type":"exact","sample_size":121,"percentile":36}}},"demographics":{"poster_types":{"member_of_the_public":7,"practitioner":2},"users":{"twitter":{"cohorts":{"Members of the public":7,"Practitioners (doctors, other healthcare professionals)":2}},"mendeley":{"by_status":{"Professor > Associate Professor":3,"Researcher":12,"Student  > Doctoral Student":4,"Student  > Ph. D. Student":12,"Student  > Postgraduate":3,"Other":9,"Student  > Master":4,"Student  > Bachelor":3,"Lecturer":3,"Lecturer > Senior Lecturer":1,"Professor":3},"by_discipline":{"Engineering":2,"Medicine and Dentistry":45,"Agricultural and Biological Sciences":6,"Nursing and Health Professions":2,"Biochemistry, Genetics and Molecular Biology":1,"Mathematics":1}}},"geo":{"twitter":{"BA":1,"GB":1,"CA":3,"JP":1},"mendeley":{"BR":1,"GB":1,"AU":1}}},"posts":{"twitter":[{"url":"http://twitter.com/youareinformed/statuses/307101916456951811","license":"public","citation_ids":[1270180],"posted_on":"2013-02-28T12:16:17+00:00","author":{"name":"Tom","url":"http://keepingyouinformed.ws","image":"https://pbs.twimg.com/profile_images/453614701675442177/qvsUc2sn_normal.png","description":"Keeping you informed is our top priority.","id_on_source":"youareinformed","tweeter_id":"341140588","geo":{"lt":null,"ln":null},"followers":4542},"tweet_id":"307101916456951811"},{"url":"http://twitter.com/medicineupdate/statuses/307115001905291264","license":"public","citation_ids":[1270180],"posted_on":"2013-02-28T13:08:17+00:00","author":{"name":"Tom","url":"http://j.gs/1K3w","image":"https://pbs.twimg.com/profile_images/3388626222/3c70af58befec0257424ebde88c5f261_normal.png","description":"The top 5 internal medicine journals","id_on_source":"medicineupdate","tweeter_id":"174988635","geo":{"lt":null,"ln":null},"followers":3346},"tweet_id":"307115001905291264"},{"url":"http://twitter.com/tomheston/statuses/307372388302061569","license":"public","citation_ids":[1270180],"posted_on":"2013-03-01T06:11:02+00:00","author":{"name":"Tom Heston","url":"http://tomheston.com","image":"https://pbs.twimg.com/profile_images/452650157050302464/-kGG7sgd_normal.png","description":"I help people make wise health decisions. Theese are my medical newsfeed tweets. Follow @tomhestonmd for my personal tweets.","id_on_source":"tomheston","tweeter_id":"21013461","geo":{"lt":44.25,"ln":17.83333,"country":"BA"},"followers":83621},"tweet_id":"307372388302061569"},{"url":"http://twitter.com/jackcjay/statuses/322339340355256320","license":"public","citation_ids":[1270180],"posted_on":"2013-04-11T13:24:22+00:00","author":{"name":"Jack Jay, MD","image":"http://pbs.twimg.com/profile_images/2624785739/image_normal.jpg","description":"Physician, Hospitalist, 12X marathoner","id_on_source":"jackcjay","tweeter_id":"762638456","followers":336},"tweet_id":"322339340355256320"},{"url":"http://twitter.com/MRCCTU/status/469857003599568896","license":"datasift","citation_ids":[1270180],"posted_on":"2014-05-23T15:06:53+00:00","author":{"name":"MRC CTU at UCL","url":"http://www.ctu.mrc.ac.uk","image":"https://pbs.twimg.com/profile_images/758966848780062721/O0KHPUUB_normal.jpg","description":"The MRC Clinical Trials Unit @UCL works on answering internationally important questions in infectious diseases and  cancer, and improving trial methodology.","id_on_source":"MRCCTU","tweeter_id":"539894768","geo":{"lt":51.50853,"ln":-0.12574,"country":"GB"},"followers":1933},"tweet_id":"469857003599568896"},{"url":"https://twitter.com/acvq2014/status/569688515153403904","license":"datasift","citation_ids":[1270180],"posted_on":"2015-02-23T02:41:40+00:00","author":{"name":"ACVQ","url":"http://www.acvq.net/","image":"http://pbs.twimg.com/profile_images/378800000564512907/211e8a88a2e63bef937a741eeaf05c8b_normal.jpeg","description":"ACVQ Association des chirurgiens vasculaires du Québec","id_on_source":"acvq2014","tweeter_id":"1478494718","geo":{"lt":"54","ln":"-72","country":"CA"},"followers":12},"tweet_id":"569688515153403904"},{"url":"https://twitter.com/pranavi_r/status/515892377165496320","license":"datasift","citation_ids":[1270180],"posted_on":"2014-09-27T15:55:02+00:00","author":{"name":"Pranavi","image":"http://pbs.twimg.com/profile_images/2584349590/zxvch1swpic7dcgjiefh_normal.jpeg","description":"Vascular surgery resident. YYZ native. Poetry lover. Wannabe chef. Part-time vegetarian. Binge-tweeter.","id_on_source":"pranavi_r","tweeter_id":"491789595","geo":{"lt":"45.4210328","ln":"-75.6900219","country":"CA"},"followers":68},"tweet_id":"515892377165496320"},{"url":"http://twitter.com/37phoenix/statuses/318297956551901185","license":"datasift","citation_ids":[1270180],"posted_on":"2013-03-31T09:45:21+00:00","author":{"name":"トンヌラ","image":"https://pbs.twimg.com/profile_images/493513156627406849/YjTY4Ss6_normal.jpeg","description":"へっぽこ内科医。情報収集、メモに使用しているため、あまりつぶやきません。フォローバックはしていません。","id_on_source":"37phoenix","tweeter_id":"407007778","geo":{"lt":35.68536,"ln":139.75309,"country":"JP"},"followers":98},"tweet_id":"318297956551901185"},{"url":"http://twitter.com/allardmaryse5/statuses/731252143894765568","license":"gnip","citation_ids":[1270180],"posted_on":"2016-05-13T22:37:51+00:00","author":{"name":"maryse allard","url":"https://santemallar.wordpress.com/","image":"https://pbs.twimg.com/profile_images/529067802343129088/vPwHI6f-_normal.jpeg","description":"Inf. clinicienne vasculaire, parent enfant autiste. Course à pied est ma bouée de sauvetage http://on.fb.me/1vpCgrX Pianiste, artiste peintre à ses heures","id_on_source":"allardmaryse5","tweeter_id":"2802597685","geo":{"lt":46.81228,"ln":-71.21454,"country":"CA"},"followers":388},"tweet_id":"731252143894765568"}],"wikipedia":[{"title":"Abdominal aortic aneurysm","url":"http://en.wikipedia.org/?diff=prev&oldid=550058363#altmetric_citation_70","license":"public","citation_ids":[1270180,1270180],"posted_on":"2013-04-12T20:52:04+00:00","summary":"Abdominal aortic aneurysm (AAA or triple A) is a localized enlargement of the abdominal aorta such that the diameter is greater than 3&nbsp;cm or more than 50% larger than normal diameter.","page_url":"http://en.wikipedia.org/?curid=841096","wiki_lang":"en","author":{"name":"Doc James","url":"http://en.wikipedia.org/wiki/User:Doc James"}}]},"score":8.75,"images":{"small":"https://badges.altmetric.com/?size=64&score=9&types=tttttttw","medium":"https://badges.altmetric.com/?size=100&score=9&types=tttttttw","large":"https://badges.altmetric.com/?size=180&score=9&types=tttttttw"}}'

        self.result = None

        data = json.loads(test_json)
        self.result = self.test_altmetric_loader.parse_result(data)


    def teardown_method(self):

        self.test_altmetric_loader = None

    def test_altmetric_id_returned(self):

        assert self.result.altmetric_id == '1270180'

    def test_article_title(self):

        assert self.result.article_title == 'Surveillance Intervals for Small Abdominal Aortic Aneurysms: A Meta-analysis'

    def test_journal_title_returned(self):

        assert self.result.journal_title == "JAMA: Journal of the American Medical Association"

    def test_altmetric_score_returned(self):

        assert self.result.altmetric_score == 8.75

    def test_print_publication_date(self):

        assert self.result.print_publication_date == '2013-02-27T00:00:00+00:00'

    def test_first_seen_on_date(self):

        assert self.result.first_seen_on_date == '2013-02-28T12:16:27+00:00'

    def test_altmetric_jid(self):

        assert self.result.altmetric_journal_id == '4f6fa4ee3cf058f610002c38'

    def test_total_mentions(self):

        assert self.result.total_mentions == 10